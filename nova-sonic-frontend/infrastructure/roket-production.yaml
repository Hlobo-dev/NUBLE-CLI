AWSTemplateFormatVersion: '2010-09-09'
Description: >
  ROKET Production Infrastructure — Performance-optimized, multi-tenant AI platform.
  Includes: VPC, ECS Fargate (auto-scaling), ALB with sticky sessions, CloudFront CDN,
  WAF, Secrets Manager, DynamoDB, CloudWatch alarms, and full DNS setup.

# ============================================
# PARAMETERS
# ============================================
Parameters:
  DomainName:
    Type: String
    Default: cloudlobo.com
    Description: Primary domain name

  HostedZoneId:
    Type: String
    Default: Z05234473O5MBYH58XZUM
    Description: Route 53 Hosted Zone ID

  Environment:
    Type: String
    Default: production
    AllowedValues: [development, staging, production]

  ProjectName:
    Type: String
    Default: roket

  # Container sizing — right-sized for real-time bidirectional streaming
  TaskCpu:
    Type: String
    Default: '1024'
    Description: 'Fargate task CPU (1024 = 1 vCPU). Nova Sonic streaming is CPU-bound.'

  TaskMemory:
    Type: String
    Default: '2048'
    Description: 'Fargate task memory in MB'

  MinTasks:
    Type: Number
    Default: 2
    Description: Minimum number of ECS tasks (multi-AZ by default)

  MaxTasks:
    Type: Number
    Default: 10
    Description: Maximum number of ECS tasks for auto-scaling

  # Secrets
  AnthropicApiKeyArn:
    Type: String
    Description: ARN of Secrets Manager secret containing ANTHROPIC_API_KEY
    Default: ''

  JwtSecretArn:
    Type: String
    Description: ARN of Secrets Manager secret containing JWT_SECRET
    Default: ''

Conditions:
  HasAnthropicSecret: !Not [!Equals [!Ref AnthropicApiKeyArn, '']]
  HasJwtSecret: !Not [!Equals [!Ref JwtSecretArn, '']]
  IsProduction: !Equals [!Ref Environment, production]

Resources:
  # ============================================
  # SSL/TLS CERTIFICATE
  # ============================================
  SSLCertificate:
    Type: AWS::CertificateManager::Certificate
    Properties:
      DomainName: !Ref DomainName
      SubjectAlternativeNames:
        - !Sub '*.${DomainName}'
      ValidationMethod: DNS
      DomainValidationOptions:
        - DomainName: !Ref DomainName
          HostedZoneId: !Ref HostedZoneId
      Tags:
        - Key: Project
          Value: !Ref ProjectName

  # ============================================
  # VPC — 2 AZ, public subnets (Fargate tasks get public IPs)
  # ============================================
  VPC:
    Type: AWS::EC2::VPC
    Properties:
      CidrBlock: 10.0.0.0/16
      EnableDnsHostnames: true
      EnableDnsSupport: true
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-vpc-${Environment}'

  InternetGateway:
    Type: AWS::EC2::InternetGateway

  IGWAttachment:
    Type: AWS::EC2::VPCGatewayAttachment
    Properties:
      InternetGatewayId: !Ref InternetGateway
      VpcId: !Ref VPC

  PublicSubnet1:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref VPC
      AvailabilityZone: !Select [0, !GetAZs '']
      CidrBlock: 10.0.1.0/24
      MapPublicIpOnLaunch: true

  PublicSubnet2:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref VPC
      AvailabilityZone: !Select [1, !GetAZs '']
      CidrBlock: 10.0.2.0/24
      MapPublicIpOnLaunch: true

  PublicRouteTable:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref VPC

  DefaultPublicRoute:
    Type: AWS::EC2::Route
    DependsOn: IGWAttachment
    Properties:
      RouteTableId: !Ref PublicRouteTable
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !Ref InternetGateway

  Subnet1RTAssoc:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId: !Ref PublicRouteTable
      SubnetId: !Ref PublicSubnet1

  Subnet2RTAssoc:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId: !Ref PublicRouteTable
      SubnetId: !Ref PublicSubnet2

  # ============================================
  # SECURITY GROUPS
  # ============================================
  ALBSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: ALB — allows 80/443 from anywhere
      VpcId: !Ref VPC
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          CidrIp: 0.0.0.0/0
        - IpProtocol: tcp
          FromPort: 443
          ToPort: 443
          CidrIp: 0.0.0.0/0

  ECSSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: ECS tasks — only from ALB
      VpcId: !Ref VPC
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 3000
          ToPort: 3000
          SourceSecurityGroupId: !Ref ALBSecurityGroup

  # ============================================
  # APPLICATION LOAD BALANCER
  # ============================================
  ALB:
    Type: AWS::ElasticLoadBalancingV2::LoadBalancer
    Properties:
      Name: !Sub '${ProjectName}-alb-${Environment}'
      Scheme: internet-facing
      Type: application
      Subnets:
        - !Ref PublicSubnet1
        - !Ref PublicSubnet2
      SecurityGroups:
        - !Ref ALBSecurityGroup
      LoadBalancerAttributes:
        # Critical: 4000s idle timeout for long WebSocket/Nova Sonic sessions
        - Key: idle_timeout.timeout_seconds
          Value: '4000'
        # Enable HTTP/2 for multiplexed connections
        - Key: routing.http2.enabled
          Value: 'true'
        # Drop invalid headers (security)
        - Key: routing.http.drop_invalid_header_fields.enabled
          Value: 'true'

  # Target Group with sticky sessions (required for Socket.IO)
  TargetGroup:
    Type: AWS::ElasticLoadBalancingV2::TargetGroup
    Properties:
      Name: !Sub '${ProjectName}-tg-${Environment}'
      Port: 3000
      Protocol: HTTP
      VpcId: !Ref VPC
      TargetType: ip
      HealthCheckEnabled: true
      HealthCheckPath: /health
      HealthCheckProtocol: HTTP
      HealthCheckIntervalSeconds: 15
      HealthCheckTimeoutSeconds: 5
      HealthyThresholdCount: 2
      UnhealthyThresholdCount: 3
      TargetGroupAttributes:
        # Sticky sessions: CRITICAL for Socket.IO — ensures same user hits same container
        - Key: stickiness.enabled
          Value: 'true'
        - Key: stickiness.type
          Value: lb_cookie
        - Key: stickiness.lb_cookie.duration_seconds
          Value: '86400'
        # Deregistration delay: give in-flight WebSocket connections time to drain
        - Key: deregistration_delay.timeout_seconds
          Value: '120'

  HTTPSListener:
    Type: AWS::ElasticLoadBalancingV2::Listener
    DependsOn: SSLCertificate
    Properties:
      LoadBalancerArn: !Ref ALB
      Port: 443
      Protocol: HTTPS
      SslPolicy: ELBSecurityPolicy-TLS13-1-2-2021-06
      Certificates:
        - CertificateArn: !Ref SSLCertificate
      DefaultActions:
        - Type: forward
          TargetGroupArn: !Ref TargetGroup

  HTTPRedirect:
    Type: AWS::ElasticLoadBalancingV2::Listener
    Properties:
      LoadBalancerArn: !Ref ALB
      Port: 80
      Protocol: HTTP
      DefaultActions:
        - Type: redirect
          RedirectConfig:
            Protocol: HTTPS
            Port: '443'
            StatusCode: HTTP_301

  # ============================================
  # WAF (Web Application Firewall)
  # ============================================
  WAFWebACL:
    Type: AWS::WAFv2::WebACL
    Condition: IsProduction
    Properties:
      Name: !Sub '${ProjectName}-waf-${Environment}'
      Scope: REGIONAL
      DefaultAction:
        Allow: {}
      VisibilityConfig:
        SampledRequestsEnabled: true
        CloudWatchMetricsEnabled: true
        MetricName: !Sub '${ProjectName}-waf'
      Rules:
        # Rate limiting: 2000 requests per 5 minutes per IP
        - Name: RateLimitRule
          Priority: 1
          Action:
            Block: {}
          VisibilityConfig:
            SampledRequestsEnabled: true
            CloudWatchMetricsEnabled: true
            MetricName: RateLimit
          Statement:
            RateBasedStatement:
              Limit: 2000
              AggregateKeyType: IP
        # AWS Managed Rules — common vulnerabilities
        - Name: AWSManagedRulesCommonRuleSet
          Priority: 2
          OverrideAction:
            None: {}
          VisibilityConfig:
            SampledRequestsEnabled: true
            CloudWatchMetricsEnabled: true
            MetricName: CommonRules
          Statement:
            ManagedRuleGroupStatement:
              VendorName: AWS
              Name: AWSManagedRulesCommonRuleSet
              ExcludedRules:
                # Exclude body size check (we send audio data)
                - Name: SizeRestrictions_BODY
        # AWS Managed Rules — known bad inputs
        - Name: AWSManagedRulesKnownBadInputsRuleSet
          Priority: 3
          OverrideAction:
            None: {}
          VisibilityConfig:
            SampledRequestsEnabled: true
            CloudWatchMetricsEnabled: true
            MetricName: KnownBadInputs
          Statement:
            ManagedRuleGroupStatement:
              VendorName: AWS
              Name: AWSManagedRulesKnownBadInputsRuleSet

  WAFAssociation:
    Type: AWS::WAFv2::WebACLAssociation
    Condition: IsProduction
    Properties:
      ResourceArn: !Ref ALB
      WebACLArn: !GetAtt WAFWebACL.Arn

  # ============================================
  # CLOUDFRONT CDN (for static frontend assets)
  # ============================================
  CloudFrontDistribution:
    Type: AWS::CloudFront::Distribution
    Condition: IsProduction
    Properties:
      DistributionConfig:
        Enabled: true
        Comment: !Sub '${ProjectName} CDN'
        Aliases:
          - !Ref DomainName
          - !Sub 'www.${DomainName}'
        ViewerCertificate:
          AcmCertificateArn: !Ref SSLCertificate
          SslSupportMethod: sni-only
          MinimumProtocolVersion: TLSv1.2_2021
        DefaultCacheBehavior:
          # Pass everything to ALB by default (API + WebSocket)
          TargetOriginId: ALBOrigin
          ViewerProtocolPolicy: redirect-to-https
          AllowedMethods: [GET, HEAD, OPTIONS, PUT, POST, PATCH, DELETE]
          CachedMethods: [GET, HEAD]
          CachePolicyId: 4135ea2d-6df8-44a3-9df3-4b5a84be39ad  # CachingDisabled
          OriginRequestPolicyId: 216adef6-5c7f-47e4-b989-5492eafa07d3  # AllViewer
          Compress: true
        CacheBehaviors:
          # Cache static assets aggressively
          - PathPattern: '/static/*'
            TargetOriginId: ALBOrigin
            ViewerProtocolPolicy: redirect-to-https
            AllowedMethods: [GET, HEAD]
            CachedMethods: [GET, HEAD]
            CachePolicyId: 658327ea-f89d-4fab-a63d-7e88639e58f6  # CachingOptimized
            Compress: true
          # Cache built frontend assets
          - PathPattern: '/_app/*'
            TargetOriginId: ALBOrigin
            ViewerProtocolPolicy: redirect-to-https
            AllowedMethods: [GET, HEAD]
            CachedMethods: [GET, HEAD]
            CachePolicyId: 658327ea-f89d-4fab-a63d-7e88639e58f6  # CachingOptimized
            Compress: true
          - PathPattern: '/assets/*'
            TargetOriginId: ALBOrigin
            ViewerProtocolPolicy: redirect-to-https
            AllowedMethods: [GET, HEAD]
            CachedMethods: [GET, HEAD]
            CachePolicyId: 658327ea-f89d-4fab-a63d-7e88639e58f6  # CachingOptimized
            Compress: true
        Origins:
          - Id: ALBOrigin
            DomainName: !GetAtt ALB.DNSName
            CustomOriginConfig:
              HTTPPort: 80
              HTTPSPort: 443
              OriginProtocolPolicy: https-only
              OriginSSLProtocols: [TLSv1.2]
              OriginReadTimeout: 60
              OriginKeepaliveTimeout: 5
        HttpVersion: http2and3
        PriceClass: PriceClass_100  # NA + EU (cheapest)

  # ============================================
  # ECR REPOSITORY
  # ============================================
  ECRRepository:
    Type: AWS::ECR::Repository
    Properties:
      RepositoryName: !Sub '${ProjectName}/${Environment}'
      ImageScanningConfiguration:
        ScanOnPush: true
      LifecyclePolicy:
        LifecyclePolicyText: |
          {
            "rules": [{
              "rulePriority": 1,
              "description": "Keep last 10 images",
              "selection": { "tagStatus": "any", "countType": "imageCountMoreThan", "countNumber": 10 },
              "action": { "type": "expire" }
            }]
          }

  # ============================================
  # IAM ROLES
  # ============================================
  ECSTaskExecutionRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: !Sub '${ProjectName}-exec-role-${Environment}'
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Effect: Allow
            Principal:
              Service: ecs-tasks.amazonaws.com
            Action: sts:AssumeRole
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy
      Policies:
        - PolicyName: SecretsManagerAccess
          PolicyDocument:
            Version: '2012-10-17'
            Statement:
              - Effect: Allow
                Action:
                  - secretsmanager:GetSecretValue
                Resource:
                  - !If [HasAnthropicSecret, !Ref AnthropicApiKeyArn, !Ref 'AWS::NoValue']
                  - !If [HasJwtSecret, !Ref JwtSecretArn, !Ref 'AWS::NoValue']

  ECSTaskRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: !Sub '${ProjectName}-task-role-${Environment}'
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Effect: Allow
            Principal:
              Service: ecs-tasks.amazonaws.com
            Action: sts:AssumeRole
      Policies:
        - PolicyName: BedrockAccess
          PolicyDocument:
            Version: '2012-10-17'
            Statement:
              - Effect: Allow
                Action:
                  - bedrock:InvokeModel
                  - bedrock:InvokeModelWithResponseStream
                  - bedrock:InvokeModelWithBidirectionalStream
                # Least-privilege: only Nova Sonic model
                Resource:
                  - !Sub 'arn:aws:bedrock:${AWS::Region}::foundation-model/amazon.nova-sonic-v1:0'
                  - !Sub 'arn:aws:bedrock:${AWS::Region}::foundation-model/amazon.nova-2-sonic-v1:0'

  # ============================================
  # CLOUDWATCH LOGS
  # ============================================
  LogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub '/ecs/${ProjectName}-${Environment}'
      RetentionInDays: !If [IsProduction, 90, 14]

  # ============================================
  # ECS CLUSTER, TASK, SERVICE + AUTO-SCALING
  # ============================================
  ECSCluster:
    Type: AWS::ECS::Cluster
    Properties:
      ClusterName: !Sub '${ProjectName}-cluster-${Environment}'
      CapacityProviders:
        - FARGATE
        - FARGATE_SPOT
      DefaultCapacityProviderStrategy:
        - CapacityProvider: FARGATE
          Weight: 1
      ClusterSettings:
        - Name: containerInsights
          Value: enabled

  TaskDefinition:
    Type: AWS::ECS::TaskDefinition
    Properties:
      Family: !Sub '${ProjectName}-task-${Environment}'
      Cpu: !Ref TaskCpu
      Memory: !Ref TaskMemory
      NetworkMode: awsvpc
      RequiresCompatibilities: [FARGATE]
      ExecutionRoleArn: !GetAtt ECSTaskExecutionRole.Arn
      TaskRoleArn: !GetAtt ECSTaskRole.Arn
      ContainerDefinitions:
        - Name: !Sub '${ProjectName}-app'
          Image: !Sub '${AWS::AccountId}.dkr.ecr.${AWS::Region}.amazonaws.com/${ECRRepository}:latest'
          PortMappings:
            - ContainerPort: 3000
              Protocol: tcp
          Environment:
            - Name: NODE_ENV
              Value: production
            - Name: AWS_REGION
              Value: !Ref AWS::Region
            - Name: PORT
              Value: '3000'
            - Name: SERVE_FRONTEND
              Value: 'true'
            - Name: FRONTEND_PATH
              Value: /app/frontend-build
            - Name: LOG_LEVEL
              Value: info
            - Name: ANTHROPIC_TIMEOUT_MS
              Value: '120000'
          Secrets:
            - !If
              - HasAnthropicSecret
              - Name: ANTHROPIC_API_KEY
                ValueFrom: !Ref AnthropicApiKeyArn
              - !Ref 'AWS::NoValue'
            - !If
              - HasJwtSecret
              - Name: JWT_SECRET
                ValueFrom: !Ref JwtSecretArn
              - !Ref 'AWS::NoValue'
          LogConfiguration:
            LogDriver: awslogs
            Options:
              awslogs-group: !Ref LogGroup
              awslogs-region: !Ref AWS::Region
              awslogs-stream-prefix: ecs
          Essential: true
          # Ulimits: increase file descriptors for many WebSocket connections
          Ulimits:
            - Name: nofile
              SoftLimit: 65535
              HardLimit: 65535

  ECSService:
    Type: AWS::ECS::Service
    DependsOn:
      - HTTPSListener
      - HTTPRedirect
    Properties:
      ServiceName: !Sub '${ProjectName}-service-${Environment}'
      Cluster: !Ref ECSCluster
      TaskDefinition: !Ref TaskDefinition
      DesiredCount: !Ref MinTasks
      LaunchType: FARGATE
      NetworkConfiguration:
        AwsvpcConfiguration:
          AssignPublicIp: ENABLED
          Subnets:
            - !Ref PublicSubnet1
            - !Ref PublicSubnet2
          SecurityGroups:
            - !Ref ECSSecurityGroup
      LoadBalancers:
        - ContainerName: !Sub '${ProjectName}-app'
          ContainerPort: 3000
          TargetGroupArn: !Ref TargetGroup
      DeploymentConfiguration:
        MinimumHealthyPercent: 100
        MaximumPercent: 200
      DeploymentController:
        Type: ECS
      # Enable ECS Exec for production debugging
      EnableExecuteCommand: true

  # ---- Auto-Scaling ----
  AutoScalingTarget:
    Type: AWS::ApplicationAutoScaling::ScalableTarget
    Properties:
      MaxCapacity: !Ref MaxTasks
      MinCapacity: !Ref MinTasks
      ResourceId: !Sub 'service/${ECSCluster}/${ECSService.Name}'
      ScalableDimension: ecs:service:DesiredCount
      ServiceNamespace: ecs

  # Scale on CPU utilization (Nova Sonic streaming is CPU-intensive)
  CPUScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub '${ProjectName}-cpu-scaling'
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref AutoScalingTarget
      TargetTrackingScalingPolicyConfiguration:
        PredefinedMetricSpecification:
          PredefinedMetricType: ECSServiceAverageCPUUtilization
        TargetValue: 60
        ScaleInCooldown: 300
        ScaleOutCooldown: 60

  # Scale on memory utilization
  MemoryScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub '${ProjectName}-memory-scaling'
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref AutoScalingTarget
      TargetTrackingScalingPolicyConfiguration:
        PredefinedMetricSpecification:
          PredefinedMetricType: ECSServiceAverageMemoryUtilization
        TargetValue: 75
        ScaleInCooldown: 300
        ScaleOutCooldown: 60

  # Scale on ALB request count (for bursty chat traffic)
  RequestCountScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: !Sub '${ProjectName}-request-scaling'
      PolicyType: TargetTrackingScaling
      ScalingTargetId: !Ref AutoScalingTarget
      TargetTrackingScalingPolicyConfiguration:
        PredefinedMetricSpecification:
          PredefinedMetricType: ALBRequestCountPerTarget
          ResourceLabel: !Sub '${ALB.LoadBalancerFullName}/${TargetGroup.TargetGroupFullName}'
        TargetValue: 500
        ScaleInCooldown: 300
        ScaleOutCooldown: 60

  # ============================================
  # CLOUDWATCH ALARMS
  # ============================================
  HighCPUAlarm:
    Type: AWS::CloudWatch::Alarm
    Condition: IsProduction
    Properties:
      AlarmName: !Sub '${ProjectName}-high-cpu-${Environment}'
      AlarmDescription: ECS service CPU > 80% for 5 minutes
      MetricName: CPUUtilization
      Namespace: AWS/ECS
      Statistic: Average
      Period: 300
      EvaluationPeriods: 2
      Threshold: 80
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: ClusterName
          Value: !Ref ECSCluster
        - Name: ServiceName
          Value: !GetAtt ECSService.Name

  UnhealthyHostAlarm:
    Type: AWS::CloudWatch::Alarm
    Condition: IsProduction
    Properties:
      AlarmName: !Sub '${ProjectName}-unhealthy-hosts-${Environment}'
      AlarmDescription: ALB target group has unhealthy hosts
      MetricName: UnHealthyHostCount
      Namespace: AWS/ApplicationELB
      Statistic: Sum
      Period: 60
      EvaluationPeriods: 2
      Threshold: 1
      ComparisonOperator: GreaterThanOrEqualToThreshold
      Dimensions:
        - Name: TargetGroup
          Value: !GetAtt TargetGroup.TargetGroupFullName
        - Name: LoadBalancer
          Value: !GetAtt ALB.LoadBalancerFullName

  # ============================================
  # ROUTE 53 DNS
  # ============================================
  DNSRoot:
    Type: AWS::Route53::RecordSet
    Properties:
      HostedZoneId: !Ref HostedZoneId
      Name: !Ref DomainName
      Type: A
      AliasTarget:
        # Point to CloudFront if production, ALB otherwise
        DNSName: !If
          - IsProduction
          - !GetAtt CloudFrontDistribution.DomainName
          - !GetAtt ALB.DNSName
        HostedZoneId: !If
          - IsProduction
          - Z2FDTNDATAQYW2  # CloudFront hosted zone ID (always this value)
          - !GetAtt ALB.CanonicalHostedZoneID

  DNSWww:
    Type: AWS::Route53::RecordSet
    Properties:
      HostedZoneId: !Ref HostedZoneId
      Name: !Sub 'www.${DomainName}'
      Type: A
      AliasTarget:
        DNSName: !If
          - IsProduction
          - !GetAtt CloudFrontDistribution.DomainName
          - !GetAtt ALB.DNSName
        HostedZoneId: !If
          - IsProduction
          - Z2FDTNDATAQYW2
          - !GetAtt ALB.CanonicalHostedZoneID

  DNSAPI:
    Type: AWS::Route53::RecordSet
    Properties:
      HostedZoneId: !Ref HostedZoneId
      Name: !Sub 'api.${DomainName}'
      Type: A
      AliasTarget:
        DNSName: !GetAtt ALB.DNSName
        HostedZoneId: !GetAtt ALB.CanonicalHostedZoneID

# ============================================
# OUTPUTS
# ============================================
Outputs:
  WebsiteURL:
    Value: !Sub 'https://${DomainName}'

  ALBDNS:
    Value: !GetAtt ALB.DNSName

  ECRUri:
    Value: !Sub '${AWS::AccountId}.dkr.ecr.${AWS::Region}.amazonaws.com/${ECRRepository}'

  ClusterName:
    Value: !Ref ECSCluster

  ServiceName:
    Value: !GetAtt ECSService.Name

  LogGroup:
    Value: !Ref LogGroup
